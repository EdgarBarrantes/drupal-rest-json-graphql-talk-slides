import future from "@mdx-deck/themes/future";
import { syntaxHighlighter } from "@mdx-deck/themes/";
import { Notes } from "mdx-deck";

export const themes = [future, syntaxHighlighter];

# REST, GraphQL o JSON:API

## (qué no hacer)

<sub>
  <sup>https://dccr19-deck.netlify.com</sup>
</sub>

---

# ¿Por qué hablar de esto?

<sub>
  <sup>https://dccr19-deck.netlify.com</sup>
</sub>

<Notes>
  <div>- Tendencia: Backend/Frontend desacoplado.</div>{" "}
  <div>
    - Aprovechar seguridad, eg: gatsby al frente, más difícil saber qué hay
    detrás.
  </div>{" "}
  <div>- Performance, Eg: static builds</div>{" "}
  <div>- CMS ergonomics for the end user</div>{" "}
  <div>
    - Separar concerns. Eg: "Future proof" aplicaciones al separar la data de la
    capa de presentación. Doble EG: Smartwatches.
  </div>
</Notes>

---

<div>
  <img src="./img/js-frameworks.png" />
</div>

<Notes>
  <div>- JS frameworks se han reproducido como cucarachas.</div>
</Notes>

<!-- Credit: https://rubygarage.org/blog/best-javascript-frameworks-for-front-end -->

---

<div>
  <img style={{ height: "350px" }} src="./img/be-frameworks.png" />
</div>

<Notes>
  <div>- Existen frameworks en backend.</div>{" "}
  <div>- Drupal anda por el mismo camino.</div>
</Notes>

<!-- Credit: https://teqnation.com/top-7-backend-web-frameworks-to-use-in-2019/ -->

---

# ¿Quienes somos?

---

# Andreas

<img
  src="https://raw.githubusercontent.com/andreaslorozco/gatsby-blog/master/src/images/profile-picture-small.jpg"
  alt="Image de Andreas, un chavalazo."
  style={{ width: "200px" }}
/>
<div style={{ textTransform: "lowercase" }}>@andreaslorozco</div>

<Notes>

</Notes>

---

# Edgar

<img
  src="https://avatars0.githubusercontent.com/u/11295946?s=460&v=4"
  alt="Image de Edgar, carajo místico."
  style={{ width: "200px" }}
/>
<div style={{ textTransform: "lowercase" }}>@EdgarBarrantes</div>

---

<div>
  <img style={{ height: "700px" }} src="./img/headless-vs-decoupled.png" />
</div>

<Notes>
  <div>- Concepto</div> <div>- Headless: No template at all.</div>{" "}
  <div>- Decoupled: Hay de todo papá!</div>
  <br />
</Notes>

<!-- Credit: https://www.coredna.com/blogs/headless-vs-decoupled-cms -->

---

# REST API

### ¿Qué es REST?

### ¿Qué es Restful web services?

<Notes>
  <div>- REST (REpresentational State Transfer)</div>{" "}
  <div>
    - Originalmente: estilo de arquitectura para desarrollar web services.
  </div>{" "}
  <div>- Ahora: Se le considera rest a casi todo api que pasa por http(s)</div>{" "}
  <div>
    - Hay propiedades y limitante (constrains) que deben seguir las apis
    restful.
  </div>{" "}
  <div>
    - Es lenguaje-independiente. Siempre que puedan realizar requests usando
    HTTP.
  </div>
</Notes>

---

# REST API

## Configuración del módulo

- ¡Habilitarlo!
- Habilitar endpoints

<Notes>
  <div>- Habilitarlo, está en core.</div>
  <div>- Opcional: rest ui.</div>
</Notes>

---

# REST API

### Opcional

<div>
  <img style={{ height: "300px" }} src="./img/rest-ui.png" />
</div>

<Notes>
  <div>- Permite control sobre endpoints visualmente</div>{" "}
  <div>- Es posible no usarlo y configurar el módulo a pie.</div>
</Notes>

---

# REST API

### Habilitar endpoints

<div>
  <img style={{ height: "300px" }} src="./img/rest-endpoints.png" />
</div>

<Notes>
  <div>- Se habilitan cuando se necesitan.</div>
</Notes>

---

# REST API

### Settings

<div>
  <img style={{ height: "300px" }} src="./img/rest-settings.png" />
</div>

<Notes>
  <div>- Se pueden configurar granularmente</div>{" "}
  <div>- Format y Auth para todo, o por cada tipo de método</div>
</Notes>

---

# REST API

## Eficiencia

<Notes>
  <div>- Múltiples requests para cada cosa</div> <div>- Bloated</div>
</Notes>

---

# REST API

## Documentación, explorabilidad y schema.

<Notes>
  <div>- Pobre, no es explorable, no hay schema</div>
</Notes>

---

# JSON:API

## ¿Que es JSON:API?

<Notes>
  <div>
    - Especificacion de como un cliente debe solicitar que recursos sean traidos
    o modificados
  </div>{" "}
  <div>- Cómo ese servidor debe responder a esas solicitudes</div>{" "}
  <div>
    - Minimiza numero de solicitudes y cantidad de data transmitida entre
    clientes y servidores
  </div>{" "}
  <div>
    - Eficiencia conseguida sin comprometer capacidad para ser leido, su
    flexibilidad o forma de ser descubierto
  </div>
</Notes>

---

## JSON:API - Convenciones

- **MUST** - Content-Type: application/vnd.api+json
- **MUST** - Objeto JSON en raiz de toda solicitud y respuesta JSON:API.
- **MAY** - Documento respuesta puede contener: `jsonapi:`, `links:`, `included:`

<Notes>
  <div>
    - (1) Clientes DEBEN enviar todos los documentos de solicitud (request
    documents) con el header...
  </div>{" "}
  <div>
    - (1) Servers DEBEN enviar todos los documentos de solicitud (request
    documents) con el header...
  </div>{" "}
  <div>
    - (2) Tanto los documentos de solicitud y respuesta deben contener en su
    raíz un objeto JSON.
  </div>{" "}
  <div>
    - (3) Un documento de respuesta debe contener alguna de estas propiedades.
    Sin embargo si la propiedad 'data' no existe en la respuesta, no se debe
    incluir la propiedad included.
  </div>
</Notes>

---

# JSON:API

### Especificación

https://jsonapi.org/format/

---

# JSON:API

## Configuración del módulo

- ¡Habilitarlo!

<Notes>
  <div>- Viene en el core.</div>{" "}
</Notes>

---

# JSON:API

## Opcional

<div>
  <img style={{ height: "500px" }} src="./img/json-extras-mod.png" />
</div>

<Notes>
  <div>- JSON:API Extras permite configurar endpoints por interfaz.</div>{" "}
  <div>
    - JSON:API Defaults permite configurar defaults para included y filter.
  </div>{" "}
</Notes>

---

# JSON:API

## Configuración

<div>
  <img style={{ height: "300px" }} src="./img/json-module.png" />
</div>

<Notes>
  <div>- Setting de seguridad recién añadido</div>{" "}
</Notes>

---

# JSON:API

## Configuración

<div>
  <img style={{ height: "400px" }} src="./img/json-extras.png" />
</div>

<Notes>
  <div>- Permite cambiar prefix</div> <div>- Añadir un counter</div>{" "}
</Notes>

---

# JSON:API

## Configuración

<div>
  <img style={{ height: "400px" }} src="./img/json-endpoints.png" />
</div>

<Notes>
  <div>
    - JSON:API Extras permite modificar los campos por default que se van a
    enviar
  </div>{" "}
  <div>- JSON:API Deja todos los endpoints expuestos por default</div>{" "}
</Notes>

---

# JSON:API

## Eficiencia

<Notes>
  <div>- Excelente.</div>{" "}
  <div>
    - Una solicitud es usualmente suficiente para la mayoría de las necesidades.
  </div>{" "}
  <div>
    - Las respuestas pueden ser configuradas para retornar únicamente lo que se
    require.
  </div>
</Notes>

---

# JSON:API

## Documentación, Explorabilidad y Schema

<Notes>
  <div>- Aceptable.</div>
  <div>- JSON:API se puede explicar por si mismo.</div>
  <div>
    - A través de las propiedades de links/errores de las respuestas es posible
    obtener información, navegar entre recursos y explorar sus campos.
  </div>
</Notes>

---

# GraphQL

### ¿Qué es GraphQL? ¿Y GraphQL el módulo contribuído?

<Notes>.</Notes>

---

# GraphQL

## Eficiencia

<Notes>
  <div>- Excelente</div> <div>Un single request es generalmente suficiente</div>{" "}
  <div>La respuestas incluyen exactamente sólo lo que se pidió</div>
</Notes>

---

# GraphQL

- Documentación, explorabilidad, y schema

<!-- Meterle imágen de Explorer/Voyager -->

<Notes>
  <div>- La documentación es excelente</div>{" "}
  <div>- Es increíblemente explorable</div> <div>- El schema es preciso</div>{" "}
  <div>- Además, incluye herramientas geniales como voyager y explorer</div>{" "}
  <div>- Voyager permite ver todo el schema de forma visualmente agradable</div>{" "}
  <div>- Explorer permite hacer requests desde el mismo drupals</div>{" "}
</Notes>

---

# [dccr19-gb<br />.netlify.com](https://dccr19-gb.netlify.com)

![](./img/qr.png)

---

# ¿Cómo interactuar?

### JAVASCRIPT ALL THE THINGS!

<Notes>
  <div>
    Por tiempo, y por que es lo más común, nos vamos a enfocar en leer y
    escribir
  </div>
</Notes>

---

# REST API

## GET

```js
fetch("https://dev-dc2019-rest-jsonapi-graphql.pantheonsite.io/signatures", {
  method: "GET",
  headers: {
    Accept: "application/json"
  }
});
```

<Notes>
  <div>-</div>{" "}
</Notes>

---

# REST API

## POST: Body

```js
const body = {
  _links: {
    type: {
      href:
        "http://dev-dc2019-rest-jsonapi-graphql.pantheonsite.io/rest/type/node/signature"
    }
  },
  type: [
    {
      target_id: "signature"
    }
  ],
  title: [
    {
      value: "Andreas"
    }
  ],
  field_message: [
    {
      value: "Hola Camp!"
    }
  ],
  field_posted_through: [
    {
      value: "REST API"
    }
  ]
};
```

<Notes>
  <div>-</div>{" "}
</Notes>

---

# REST API

## POST: Fetch

```js
fetch(
  "http://dev-dc2019-rest-jsonapi-graphql.pantheonsite.io/node?_format=hal_json",
  {
    method: "POST",
    headers: {
      Accept: "application/hal+json",
      "Content-Type": "application/hal+json",
      Authorization:
        "Basic RHVtbXfBY2NvdW50OjRyWVFiaVhTTmtaM0NudkdhSkZSNnBibg=="
    },
    body: JSON.stringify(body)
  }
);
```

<Notes>
  <div>-</div>{" "}
</Notes>

---

# JSON:API

## GET

```js
fetch(
  "https://dev-dc2019-rest-jsonapi-graphql.pantheonsite.io/jsonapi/node/signature",
  {
    method: "GET",
    headers: {
      Accept: "application/vnd.api+json",
      "Content-Type": "application/vnd.api+json",
      Authorization:
        "Basic RHVtbXlBY2NvdW50OjRyWVFikVhTTmtaM0NudkdhSkZSNnBibg=="
    }
  }
);
```

<Notes>
  <div>-</div>{" "}
</Notes>

---

# JSON:API

## POST

```js
fetch(
  "https://dev-dc2019-rest-jsonapi-graphql.pantheonsite.io/jsonapi/node/signature",
  {
    method: "POST",
    headers: {
      Accept: "application/vnd.api+json",
      "Content-Type": "application/vnd.api+json",
      Authorization:
        "Basic RHVtbXlBY2NvdW50OjRyWVFikVhTTmtaM0NudkdhSkZSNnBibg=="
    },
    body: JSON.stringify({
      data: {
        type: "node--signature",
        attributes: {
          title: "Edgar",
          field_message: "Is this the real life?",
          field_posted_through: "JSON API"
        }
      }
    })
  }
);
```

<Notes>
  <div>-</div>{" "}
</Notes>

---

# GraphQL

## GET

```js
query {
  nodeQuery {
    count
    entities {
      entityType
      ... on NodeSignature {
        title
        fieldMessage
        fieldPostedThrough
      }
    }
  }
}
```

---

# GraphQL

## GET response body

![](./img/graphql-example.png)

---

# GraphQL

## POST: Query

```js
const query = JSON.stringify({
  query {
    mutation {
      createSignature(
        input: {
          title: "Andreas"
          field_message: "Yo yo what up?"
          field_posted_through: "GraphQL"}
      )
      {
        entity {
          entityId
        }
        errors
        violations {
          path
          message
        }
      }
    }
  }
});
```

---

# GraphQL

## POST: Fetch

```js
fetch("https://dev-dc2019-rest-jsonapi-graphql.pantheonsite.io/graphql", {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    Authorization: "Basic RHVtbXlBY2NvdW50OjRyWVFiaVhTTmtaM0NudkdhSkZSNnBibg=="
  },
  body: query
});
```

---

# PHP TIME!

---

# REST API

## Creating endpoints

<div>
  <img style={{ height: "300px" }} src="./img/rest-resource-location.png" />
</div>

<Notes>
  <div>Zoom out to 33% for the next slide</div>
</Notes>

---

# REST API

## Creating endpoints

```php

namespace Drupal\example_endpoint\Plugin\rest\resource;

use Drupal\rest\Plugin\ResourceBase;
use Drupal\rest\ResourceResponse;

/**
 * Provides an example Resource for DCCR 2019.
 *
 * @RestResource(
 *   id = "example_resource",
 *   label = @Translation("Example Resource"),
 *   uri_paths = {
 *     "canonical" = "/example_rest_api/example_resource"
 *   }
 * )
 */
class ExampleResource extends ResourceBase
{
  /**
   * Responds to entity GET requests.
   * @return \Drupal\rest\ResourceResponse
   */
  public function get()
  {
    $response = ['message' => 'Drupal no está tan mal como la gente dice.'];
    return new ResourceResponse($response);
  }
}
```

<Notes>
  <div>- Esto es un anotation based plugin</div>
</Notes>

---

# REST API

## Views REST export

<div>
  <img style={{ height: "400px" }} src="./img/rest-view.png" />
</div>

<Notes>
  <div>- Implican que el llamado llame haga un query de la base de datos</div>{" "}
  <div>- No olvidar configurar cómo tiene que ir serializado</div>{" "}
  <div>- Reducir la próxima diapositiva a 67%</div>{" "}
</Notes>

---

# GraphQL

## Mutation

https://www.amazeelabs.com/en/journal/extending-graphql-part-3-mutations

(Código ejemplo en repositorio de charla)

---

![](./img/extra-almost-there.gif)

---

# ¿Qué NO hacer?

<div>
  <img style={{ height: "700px" }} src="./img/headless.gif" />
</div>

<Notes>
  <div>- Broma</div>{" "}
</Notes>

<!-- Credit: https://jobjorisenmarieke.nl/kop-op -->

---

# ¿Qué NO hacer?

- Esperar que la Documentación sea tan bonita.
- Entrarle de lleno a quejarse de JSON:API sin conocer el spec.
- Esperar que todos los módulos estén listos para Restful services, JSON:API o GraphQL (ejemplo: [Paragraph](https://www.drupal.org/files/issues/2019-06-14/paragraphs-3047678-allow_creation_via_jsonapi-6.patch))

---

# TL;DR:

**Si usa datos que están guardados en entidades de drupal, use JSON:API**
**De lo contrario, use Restful Services**

<Notes>Poor GraphQL</Notes>

---

# Links de interés

- https://dri.es/headless-cms-rest-vs-jsonapi-vs-graphql
- https://goodapi.co/blog/rest-vs-graphql
- https://www.drupal.org/docs/8/api/restful-web-services-api/custom-rest-resources
- https://www.amazeelabs.com/en/journal/extending-graphql-part-3-mutations

---

# Links

## dccr19-deck.netlify.com

## https://github.com/EdgarBarrantes/drupal-rest-json-graphql-talk-slides

## https://dccr19-gb.netlify.com/

---

# ¡Gracias totales!

![](./img/extra-gracias.gif)
